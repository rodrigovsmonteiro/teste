<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes do Post</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        .share-buttons {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }

        .share-buttons a {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background-color: #3182ce;
            color: white;
            border-radius: 50%;
            transition: background-color 0.3s ease;
        }

        .share-buttons a:hover {
            background-color: #63b3ed;
        }
    </style>
</head>

<body class="bg-gray-100 text-gray-800">

    <!-- Navbar Fixa e Transparente -->
    <header class="fixed top-0 w-full z-50 bg-white shadow-md">
        <nav class="max-w-screen-xl container mx-auto flex justify-between items-center p-4">
            <div class="flex items-center">
                <a href="#" class="text-2xl font-bold text-black">
                    <img src="/frontend/images/logobg.png" alt="Logo" class="h-16">
                </a>
            </div>
            <div class="hidden md:flex space-x-8 relative">
                <a href="noticias.html" class="text-gray-900 hover:text-sky-600 font-semibold">Notícias</a>
                <a href="artigos.html" class="text-gray-900 hover:text-sky-600 font-semibold">Artigos</a>
                <div class="relative group">
                    <button id="tools-button" class="text-gray-900 hover:text-sky-600 font-semibold flex items-center">
                        Ferramentas
                        <svg id="tools-dropdown-icon" class="ml-2 w-4 h-4 transition-transform duration-300" fill="none"
                            stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7">
                            </path>
                        </svg>
                    </button>
                    <div id="tools-dropdown"
                        class="absolute hidden group-hover:block bg-white shadow-lg mt-0 rounded-md py-2"
                        style="min-width: 200px;">
                        <a href="#ferramenta1"
                            class="block px-4 py-2 text-gray-900 hover:text-sky-600 hover:bg-gray-100">Ferramenta
                            1</a>
                        <a href="#ferramenta2"
                            class="block px-4 py-2 text-gray-900 hover:text-sky-600 hover:bg-gray-100">Ferramenta
                            2</a>
                        <a href="#ferramenta3"
                            class="block px-4 py-2 text-gray-900 hover:text-sky-600 hover:bg-gray-100">Ferramenta
                            3</a>
                        <a href="#ferramenta4"
                            class="block px-4 py-2 text-gray-900 hover:text-sky-600 hover:bg-gray-100">Ferramenta
                            4</a>
                    </div>
                </div>
            </div>
            <div class="hidden md:block">
                <a href="https://onvio.com.br/br-portal-do-cliente/" target="_blank"
                    class="bg-sky-600 hover:bg-sky-700 text-white font-semibold py-2 px-4 rounded-md shadow-lg transition duration-300 mr-4">
                    AOB Contábil
                </a>
            </div>
            <button class="block md:hidden focus:outline-none" id="menu-button">
                <svg class="w-6 h-6 text-black hover:text-sky-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16">
                    </path>
                </svg>
            </button>
        </nav>
        <!-- Mobile Menu -->
        <div class="hidden md:hidden bg-white bg-opacity-75" id="menu">
            <a href="noticias.html" class="block text-gray-900 hover:text-sky-600 px-4 py-2">Notícias</a>
            <a href="artigos.html" class="block text-gray-900 hover:text-sky-600 px-4 py-2">Artigos</a>
            <a href="#ferramentas" class="block text-gray-900 hover:text-sky-600 px-4 py-2">Ferramentas</a>
            <a href="https://onvio.com.br/br-portal-do-cliente/" target="_blank"
                class="block bg-sky-600 text-white text-center px-4 py-2 rounded-md shadow hover:bg-sky-700">AOB
                Contábil</a>
        </div>
    </header>
    <!-- JavaScript for mobile dropdown -->
    <script>
        // Mostrar e ocultar menu no mobile
        document.getElementById('menu-button').addEventListener('click', function () {
            var menu = document.getElementById('menu');
            if (menu.style.display === 'none' || menu.style.display === '') {
                menu.style.display = 'block';
            } else {
                menu.style.display = 'none';
            }
        });

        document.querySelectorAll('#menu a').forEach(link => {
            link.addEventListener('click', function (e) {
                e.preventDefault();
                var targetId = this.getAttribute('href').substring(1);
                var targetElement = document.getElementById(targetId);
                var offsetPosition = targetElement.offsetTop - 175;

                window.scrollTo({
                    top: offsetPosition,
                    behavior: 'smooth'
                });

                document.getElementById('menu').style.display = 'none';
            });
        });
    </script>

    <!-- Post Content Section -->
    <section class="max-w-screen-xl container mx-auto px-6 py-8 pt-28">
        <div class="">
            <div class="p-4">
                <h1 class="text-4xl font-bold mb-2 text-sky-600" id="post-title">Título do Post</h1>
                <h2 class="text-2xl mb-4 text-gray-700" id="post-subtitle">Subtítulo do Post</h2>
                <p class="text-sm text-gray-600 mb-4" id="post-meta">Por <span class="font-semibold"
                        id="post-author">Autor</span> em <span id="post-date">Data</span></p>
                <p class="text-sm text-gray-600 mt-2 mb-4 hidden" id="post-fonte"><span
                        class="text-sky-600 font-semibold">Fonte:
                    </span> <span id="post-fonte-text" class=""></span></p>

                <div class="my-4 shadow rounded-lg">
                    <img src="/frontend/images/400x200.png" alt="Post Image"
                        class="w-full max-h-[500px] object-cover rounded-md" id="post-image">
                    <p class="text-md mb-2 p-4" id="post-title-bottom">Título do Post</p>
                </div>

                <div class="text-gray-700 mb-4 leading-relaxed" id="post-content">
                    <!-- Post content will be injected here -->
                </div>

                <div class="share-buttons">
                    <div class="py-4 rounded gap-4 flex">
                        <p class="py-2">Compartilhe:</p>
                        <div class="flex gap-2">
                            <a href="#" title="Compartilhar no WhatsApp"><i class="fab fa-whatsapp"></i></a>
                            <a href="#" title="Compartilhar no Instagram"><i class="fab fa-instagram"></i></a>
                            <a href="#" title="Compartilhar no Facebook"><i class="fab fa-facebook-f"></i></a>
                            <a href="#" title="Compartilhar no LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                            <a href="#" title="Compartilhar no Twitter"><i class="fab fa-x-twitter"></i></a>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </section>

    <!-- Related Posts Section -->
    <section class="max-w-screen-xl container mx-auto px-6 py-8">
        <h2 class="text-3xl font-bold px-4 mb-6 text-sky-600 hidden">Posts Relacionados</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="related-posts-section">
            <!-- Related posts will be injected here -->
        </div>
    </section>

    <!-- Footer -->
    <footer id="footer" class="relative text-sky-600 py-8 bg-gradient-to-b from-white via-gray-100 to-gray-200">
        <div class="max-w-screen-xl mx-auto px-4">
            <div
                class="relative container mx-auto flex flex-col md:flex-row justify-between items-center text-center md:text-start md:items-start gap-10 px-4 z-10">
                <div>
                    <a href="#" class="text-2xl font-bold">
                        <img src="/frontend/images/logobg.png" alt="AOB Contábil"
                            class="w-64 md:-mt-4 md:-ml-6 mx-auto">
                    </a>
                    <h3 class="text-xl font-semibold mt-2 mb-2 text-sky-600">AOB Contabilidade</h3>
                    <p class="mb-2 text-black">CNPJ: 25.344.574/0001-08</p>
                    <p class="mb-2 text-black">Marca registrada | Processo nº: 910926310/2018</p>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-2 text-sky-600">Contato</h4>
                    <p class="text-black">Rua Barão do Triunfo - 427 - Conjunto 1301, Brooklin,<br> São Paulo - SP,
                        04602-001</p>
                    <p class="text-black">(11) 2339-4043<i class="fab fa-whatsapp text-lg ml-1 text-green-600"></i></p>
                    <p class="text-black">contato@aobcontabil.com.br</p>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-2 text-sky-600 mt-0 lg:mt-0">Links Rápidos</h4>
                    <ul class="text-black">
                        <li class="mb-2 hover:text-sky-600"><a href="https://www.seusite.com">Site</a></li>
                        <li class="mb-2 hover:text-sky-600"><a href="#sobre">Sobre</a></li>
                        <li class="mb-2 hover:text-sky-600"><a href="/blog">Blog</a></li>
                        <li class="mb-2 hover:text-sky-600"><a href="#contato">Contato</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-2 text-sky-600">Redes Sociais</h4>
                    <ul class="text-black">
                        <li>
                            <a href="https://www.instagram.com/aobcontabil" class="flex mb-2 hover:text-sky-600"
                                target="_blank" rel="noopener noreferrer">
                                <i class="fab fa-instagram text-2xl mr-2 text-red-900"></i><span
                                    class="pt-1">Instagram</span>
                            </a>
                        </li>
                        <li>
                            <a href="https://www.facebook.com/aobcontabil" class="flex mb-2 hover:text-sky-600"
                                target="_blank" rel="noopener noreferrer">
                                <i class="fab fa-facebook text-2xl mr-2 text-blue-900"></i><span
                                    class="pt-1">Facebook</span>
                            </a>
                        </li>
                        <li>
                            <a href="https://www.youtube.com.br/@aobcontabil" class="flex mb-2 hover:text-sky-600"
                                target="_blank" rel="noopener noreferrer">
                                <i class="fab fa-youtube text-2xl -ml-0 mr-2 text-red-500"></i><span
                                    class="pt-1">Youtube</span>
                            </a>
                        </li>
                        <li>
                            <a href="https://linkedin.com/company/aob-contabilidade"
                                class="flex mb-2 hover:text-sky-600" target="_blank" rel="noopener noreferrer">
                                <i class="fab fa-linkedin text-2xl mr-2 text-gray-900"></i><span
                                    class="pt-1">LinkedIn</span>
                            </a>
                        </li>
                        <li>
                            <a href="https://www.x.com.br/aobcontabil" class="flex mb-2 hover:text-sky-600"
                                target="_blank" rel="noopener noreferrer">
                                <i class="fab fa-x-twitter text-2xl -ml-0 mr-2 text-black"></i><span
                                    class="pt-1">Twitter</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', async function () {
            const urlParams = new URLSearchParams(window.location.search);
            const postId = urlParams.get('id');
            if (!postId) {
                console.error('No post ID found in the URL');
                return;
            }

            try {
                const response = await fetch(`http://localhost:1337/api/posts/${postId}?populate=imagem,tags`);
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.json();
                const post = data.data;

                const imageUrl = post.attributes.imagem?.data?.length > 0 && post.attributes.imagem.data[0]?.attributes?.url
                    ? `http://localhost:1337${post.attributes.imagem.data[0].attributes.url}`
                    : '/frontend/images/400x200.png';
                const title = post.attributes.titulo || 'Título não disponível';
                const subtitle = post.attributes.subtitulo || 'Subtítulo não disponível';
                const content = post.attributes.conteudo ? formatPostContent(post.attributes.conteudo) : '';
                const author = post.attributes.autor || 'Autor desconhecido';
                const date = post.attributes.data ? new Date(post.attributes.data).toLocaleDateString() : 'Data inválida';
                const tags = post.attributes.tags?.data || [];
                const fonte = post.attributes.fonte || 'Fonte não disponível';

                document.getElementById('post-image').src = imageUrl;
                document.getElementById('post-title').innerText = title;
                document.getElementById('post-title-bottom').innerHTML = `<span class="font-semibold text-sky-600">Titulo:</span> ${title}`;
                document.getElementById('post-subtitle').innerText = subtitle;
                document.getElementById('post-meta').innerHTML = `Por <span class="font-semibold text-sky-600">${author}</span> em ${date}`;
                document.getElementById('post-content').innerHTML = content;

                if (fonte) {
                    document.getElementById('post-fonte').classList.remove('hidden');
                    document.getElementById('post-fonte-text').innerText = fonte;
                } else {
                    document.getElementById('post-fonte').classList.add('hidden');
                }

                // Fetch all posts to find related posts based on tags
                const allPostsResponse = await fetch('http://localhost:1337/api/posts?populate=imagem,tags');
                if (!allPostsResponse.ok) {
                    throw new Error('Network response was not ok');
                }
                const allPostsData = await allPostsResponse.json();
                const allPosts = allPostsData.data;

                // Filter posts to find related ones by shared tags
                const relatedPosts = allPosts.filter(p =>
                    p.id !== parseInt(postId) &&
                    p.attributes.tags.data.some(tag => tags.some(t => t.id === tag.id))
                );

                const relatedPostsSection = document.getElementById('related-posts-section');
                relatedPostsSection.innerHTML = ''; // Clear the section before adding new content

                relatedPosts.forEach(relatedPost => {
                    const relatedImageUrl = relatedPost.attributes.imagem?.data?.length > 0 && relatedPost.attributes.imagem.data[0]?.attributes?.url
                        ? `http://localhost:1337${relatedPost.attributes.imagem.data[0].attributes.url}`
                        : '/frontend/images/400x200.png';
                    const relatedTitle = relatedPost.attributes.titulo || 'Título não disponível';
                    const relatedSubtitle = relatedPost.attributes.subtitulo || 'Subtítulo não disponível';
                    const relatedAuthor = relatedPost.attributes.autor || 'Autor desconhecido';
                    const relatedDate = relatedPost.attributes.data ? new Date(relatedPost.attributes.data).toLocaleDateString() : 'Data inválida';
                    const relatedTags = relatedPost.attributes.tags?.data || [];

                    const relatedPostHTML = `
                        <article class="bg-white shadow-lg rounded-lg overflow-hidden">
                            <img src="${relatedImageUrl}" alt="${relatedTitle}" class="w-full h-48 object-cover">
                            <div class="p-6">
                                <h3 class="text-xl font-bold mb-2"><a href="post.html?id=${relatedPost.id}" class="hover:text-sky-600">${relatedTitle}</a></h3>
                                <h4 class="text-md mb-2 text-gray-700">${relatedSubtitle}</h4>
                                <p class="text-sm text-gray-600">Por <span class="font-semibold text-sky-600">${relatedAuthor}</span> em ${relatedDate}</p>
                                <div class="mt-4 flex flex-wrap">
                                    ${relatedTags.map(tag => `<span class="inline-block bg-sky-300 rounded-full px-3 py-1 text-sm font-semibold text-gray-700 mr-2 mt-2">#${tag.attributes.nome}</span>`).join('')}
                                </div>
                            </div>
                        </article>
                    `;
                    relatedPostsSection.innerHTML += relatedPostHTML;
                });

                // Set share links
                setShareLinks();
            } catch (error) {
                console.error('Error fetching post data:', error);
            }
        });

        function formatPostContent(content) {
            return content.map(block => {
                switch (block.type) {
                    case 'paragraph':
                        return `<p class="mb-8">${block.children.map(child => formatChild(child)).join('')}</p>`;
                    case 'heading':
                        return `<h${block.level} class="text-${block.level === 1 ? '4xl' : '3xl'} font-bold text-sky-600 mb-4">${block.children.map(child => formatChild(child)).join('')}</h${block.level}>`;
                    case 'list':
                        const listItems = block.children.map(child => `<li class="mb-2">${child.children.map(c => formatChild(c)).join('')}</li>`).join('');
                        return block.format === 'ordered' ? `<ol class="list-decimal list-inside mb-4">${listItems}</ol>` : `<ul class="list-disc list-inside mb-4">${listItems}</ul>`;
                    default:
                        return '';
                }
            }).join('');
        }

        function formatChild(child) {
            let formattedText = child.text;
            if (child.bold) {
                formattedText = `<strong>${formattedText}</strong>`;
            }
            if (child.italic) {
                formattedText = `<em>${formattedText}</em>`;
            }
            if (child.underline) {
                formattedText = `<u>${formattedText}</u>`;
            }
            return formattedText;
        }

        function setShareLinks() {
            const pageUrl = encodeURIComponent(window.location.href);
            const postTitle = encodeURIComponent(document.getElementById('post-title').innerText);

            const facebookLink = `https://www.facebook.com/sharer/sharer.php?u=${pageUrl}`;
            const twitterLink = `https://twitter.com/intent/tweet?url=${pageUrl}&text=${postTitle}`;
            const linkedinLink = `https://www.linkedin.com/shareArticle?mini=true&url=${pageUrl}&title=${postTitle}`;
            const whatsappLink = `https://wa.me/?text=${postTitle}%20${pageUrl}`;
            const instagramLink = `https://www.instagram.com/?url=${pageUrl}`;

            document.querySelector('.share-buttons a[title="Compartilhar no Facebook"]').href = facebookLink;
            document.querySelector('.share-buttons a[title="Compartilhar no Twitter"]').href = twitterLink;
            document.querySelector('.share-buttons a[title="Compartilhar no LinkedIn"]').href = linkedinLink;
            document.querySelector('.share-buttons a[title="Compartilhar no WhatsApp"]').href = whatsappLink;
            document.querySelector('.share-buttons a[title="Compartilhar no Instagram"]').href = instagramLink;
        }
    </script>
</body>

</html>